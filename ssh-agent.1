.\"  -*- nroff -*-
.\"
.\" ssh-agent.1
.\"
.\" Author: Tatu Ylonen <ylo@cs.hut.fi>
.\"
.\" Copyright (c) 1995 Tatu Ylonen <ylo@cs.hut.fi>, Espoo, Finland
.\"                    All rights reserved
.\"
.\" Created: Sat Apr 23 20:10:43 1995 ylo
.\" Last modified: Wed Jul 12 15:36:18 1995 ylo
.\"
.\"
.TH SSH-AGENT 1 "June 29, 1995" "SSH" "SSH"

.SH NAME
ssh-agent \- authentication agent

.SH SYNOPSIS
.B ssh-agent 
.I command

.SH DESCRIPTION 
.B Ssh-agent 
is a program to hold authentication private keys.  The
idea is that
.B ssh-agent
is started in the beginning of an X-session or a login session, and
all other windows or programs are started as children of the ssh-agent
program (the
.IR command
normally starts windows or is the user shell).  Programs started under
the agent inherit a connection to the agent, and the agent is
automatically used for RSA authentication when logging to other
machines using
.B ssh.

The agent initially does not have any private keys.  Keys are added
using
.B ssh-add.
When executed without arguments, it adds the \f4$HOME/.ssh/identity\f1
file.  If the identity has a passphrase, 
.B ssh-add
asks for the passphrase (using a small X11 application if running
under X11, or from the terminal if running without X).  It then sends
the identity to the agent.  Several identities can be stored in the
agent; the agent can automatically use any of these identities.
.B Ssh-add -l
displays the identities currently held by the agent.

The idea is that the agent is run in the user's local PC, laptop, or
terminal.  Authentication data need not be stored on any other
machine, and authentication passphrases never go over a network.
However, the connection to the agent is forwarded over
.B ssh
remote logins, and the user can thus use the privileges given by the
identities anywhere in the network in a secure way.

The agent is inherited to child programs.  There are two alternative
methods for inheriting the agent.  The preferred method is to have an
open file descriptor which is inherited, and have an environment
variable (SSH_AUTHENTICATION_FD) contain the number of this
descriptor.  This restricts access to the authentication agent to only
those programs that are siblings of the agent, and it is fairly
difficult even for root to get unauthorized access to the agent.

However, on many machines standard shells (csh, tcsh, zsh) close all
open file descriptors (originally because rsh, rlogin, and some other
programs leave file descriptors open).  This causes the connection to
the authentication agent be closed as well.  In an attempt to avoid
getting closed, the file descriptor used by the agent always has a
number greater than 20.  However, this does not help on all machines.
On these machines, an alternative method is used.  A unix-domain
socket is created (\f4/tmp/ssh_agent.*\f1), and the name of this
socket is stored in the SSH_AUTHENTICATION_SOCKET environment
variable.  The socket is made accessible only to the current user.

The method to use for the connection to the authentication agent is
automatically selected at compilation time.  Using a file descriptor
is more secure because even the same user, logged in from another
terminal, cannot get access to the agent, and getting access is hard
even for root.  In the second method, however, other sessions by the
same user and root can freely access the agent using the socket in
\f4/tmp\f1.

The agent exits automatically when the last connection to the agent
has been closed, or the command given on the command line terminates.

.SH FILES
\f4\&$HOME/.ssh/identity\f1
Contains the RSA authentication identity of the user.  This file
should not be readable by anyone but the user.  It is possible to
specify a passphrase when generating the key; that passphrase will be
used to encrypt the private part of this file using IDEA.  This file
is not used by
.B ssh-agent,
but is normally added to the agent using
.B ssh-add
at login time.
.P
\f4\&/tmp/ssh_agent.<pid>\f1
Unix-domain sockets used to contain the connection to the
authentication agent.  These sockets should only be readable by the
owner.  The sockets should get automatically removed when the agent
exits.

.SH AUTHOR
Tatu Ylonen <ylo@cs.hut.fi>

.SH SEE ALSO
ssh-add(1), ssh-keygen(1), ssh(1), sshd(8)
